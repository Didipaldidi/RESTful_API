# Use a Windows base image
FROM mcr.microsoft.com/windows/servercore:ltsc2019

# Set working directory
WORKDIR /usr/src/app

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Install system dependencies
# Note: Windows uses different package management tools (e.g., Chocolatey)
RUN powershell -Command \
    Set-ExecutionPolicy Bypass -Scope Process -Force; \
    iwr https://chocolatey.org/install.ps1 -UseBasicParsing | iex; \
    choco install netcat traditional -y; \
    choco install gcc -y; \
    choco install postgresql -y;

# Add and install Python requirements
COPY ./requirements.txt .
RUN pip install -r requirements.txt

# Add app
COPY . .

# Add entrypoint script (if needed)
# Note: PowerShell scripts (.ps1) are commonly used in Windows environments
# Ensure that entrypoint.sh is converted to a .ps1 PowerShell script if necessary
COPY ./entrypoint.sh .
RUN chmod +x /usr/src/app/entrypoint.sh

# Example for converting entrypoint.sh functionality to a PowerShell (ps1) script
# COPY ./entrypoint.ps1 .
# RUN powershell -Command Set-ExecutionPolicy Unrestricted
# RUN powershell -Command ./entrypoint.ps1
